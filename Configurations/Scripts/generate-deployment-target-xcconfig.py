#!/usr/bin/python3

import argparse
import os
import sys

parser = argparse.ArgumentParser(description='generates xcconfig build settings '
                                 'mapping 6-digit minor version integers to semvers')
parser.add_argument('major_versions', type=int, nargs='+',
                    help='list of major OS versions to generate build settings for')
args = parser.parse_args()

print(f'// Generated by {os.path.basename(sys.argv[0])}, do not manually edit.')
print('// Update by running `make` from the Configurations/ directory.')
print('// Customized deployment target based on host OS version, in lieu of rdar://166839049. '
      'Version numbers are speculative and may never exist in a real SDK.')

for os_major in args.major_versions:
    for os_minor in range(0, 10):
        print(f'_MACOSX_DEPLOYMENT_TARGET_FOR_MINOR_VERSION_{os_major:02d}{os_minor:02d}00 = {os_major}.{os_minor};')
        for sdk_major in args.major_versions:
            for sdk_minor in range(0, 10):
                if (os_major, os_minor) <= (sdk_major, sdk_minor):
                    continue
                print(f'_MACOSX_DEPLOYMENT_TARGET_FOR_MINOR_VERSION_{os_major:02d}{os_minor:02d}00'
                      f'[sdk=macosx{sdk_major}.{sdk_minor}*] = {sdk_major}.{sdk_minor};')
